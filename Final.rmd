---
title: "Covid91 vaccine study Final2024"
author: "Jamie Santiago"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
males = filter(FinalData, sex == "M")
females = filter(FinalData, sex == "F")
gay = filter(FinalData, LGBTQ == "gay")
Druguser = filter(FinalData, DrugUser == "yes")
```



# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

### Barplot

```{r}
dd2 <- males %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```


Among males, more COVID-19 cases occurred in the placebo group than in the vaccine group.The vaccine reduced COVID-19 infections among male participants.


### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=males)
rowPerc(table1)
colPerc(table1)
```

Among placebo males, 2.82% got infected, compared to just 1.02% of vaccinated males. This means males who received the vaccine were about 2.8 times less likely to get infected than those in the placebo group. These differences in infection rates provide evidence that the vaccine lowers the chance of infection in males.



### Inferential 




```{r}
chisq.test(table1)
chisqtestGC(table1)
malefish <- fisher.test(table1)
malefish
```


A chi-square test was used to check if the infection difference between the two groups was due to chance. The result shows that the difference is statistically significant. This means the vaccine’s effect in reducing infection among males is real and unlikely to be random.


```{r}
effectiveness_male = malefish$estimate / (malefish$estimate + 1) * 100
print(effectiveness_male)

low = (malefish$conf.int[1] / (malefish$conf.int[1] + 1)) * 100
hi = (malefish$conf.int[2] / (malefish$conf.int[2] + 1)) * 100
options(digits=2)
```





## Effectiveness Confidence Interval `r low`  to `r hi`



The vaccine was about 63.8% effective in preventing infection in males. Based on the chi-squared test and sample size, the 95% confidence interval for this effectiveness would roughly range from 55% to 72%, indicating a strong and reliable effect.




## Females

### Barplot

```{r}
dd2 <- females %>% group_by(infected, treatment) %>% summarize(count=n()) %>% mutate(prcnt = count/sum(count))

basicC <- ggplot(dd2, aes(x=infected, y=count, fill=treatment))
basicC + geom_bar(stat="identity", position="dodge")

basicCC <- ggplot(dd2, aes(x=infected, y=prcnt*100, fill=treatment))
basicCC + geom_bar(stat="identity", position="dodge")
```

Overall, these plots show that vaccinated females had a noticeably lower infection rate than those who received the placebo.

### Numerical results


```{r}
table1 <- xtabs(~infected + treatment, data=females)
rowPerc(table1)
colPerc(table1)
```

The rowPerc() output indicates that 65% of infected participants were from the placebo group, while only 35% were vaccinated.From colPerc(), only 1.4% of vaccinated females got COVID-19, compared to 2.6% of those who got the placebo.This shows a moderate difference in infection rates between the two groups.



### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
femfish <- fisher.test(table1)
femfish
```

The Chi-Square Test returned a small p-value, suggesting that the relationship between treatment and infection in females is statistically significant.

The Fisher’s Exact Test gives an odds ratio of 2.09, meaning females who received the vaccine were about twice as likely to avoid COVID-19 as those who received the placebo.


```{r}
effectiveness_fem = femfish$estimate / (femfish$estimate + 1) * 100
print(effectiveness_fem)

low = (femfish$conf.int[1] / (femfish$conf.int[1] + 1)) * 100
hi = (femfish$conf.int[2] / (femfish$conf.int[2] + 1)) * 100
options(digits=2)
```

The calculated effectiveness for females is approximately 67%, with a confidence interval ranging from 55.4% to 74.5%.
Since this interval is above 50%, the vaccine is considered effective for women.







## Effectiveness Confidence Interval `r low`  to `r hi`







## LGBTQ

### Barplot

```{r}
dd2 <- gay %>% group_by(infected, treatment) %>% summarize(count=n()) %>% mutate(prcnt = count/sum(count))

basicC <- ggplot(dd2, aes(x=infected, y=count, fill=treatment))
basicC + geom_bar(stat="identity", position="dodge")

basicCC <- ggplot(dd2, aes(x=infected, y=prcnt*100, fill=treatment))
basicCC + geom_bar(stat="identity", position="dodge")
```

The placebo group of gay participants had significantly more infections than the vaccinated group.


### Numerical results


```{r}
table1 <- xtabs(~infected + treatment, data=gay)
rowPerc(table1)
colPerc(table1)
```

Only 0.77% of vaccinated gay participants got COVID-19 vs 3.2% in the placebo group. This suggests a protective effect of the vaccine for gay individuals.

### Inferential 




```{r}
chisq.test(table1)
chisqtestGC(table1)
gayfish <- fisher.test(table1)
gayfish
```

Both tests show a statistically significant association between treatment and infection status (p < 0.001).The odds of infection were over 4x higher in the placebo group among gay individuals. These results are not due to chance.

```{r}
effectiveness_gay = gayfish$estimate / (gayfish$estimate + 1) * 100
print(effectiveness_gay)

low = (gayfish$conf.int[1] / (gayfish$conf.int[1] + 1)) * 100
hi = (gayfish$conf.int[2] / (gayfish$conf.int[2] + 1)) * 100
options(digits=2)
```







## Effectiveness Confidence Interval `r low`  to `r hi`




The vaccine is estimated to be 81% effective among gay individuals.The confidence interval for effectiveness is between 55% and 89%.


## Druggies

### Barplot

```{r}
dd2 <- Druguser %>% group_by(infected, treatment) %>% summarize(count=n()) %>% mutate(prcnt = count/sum(count))

basicC <- ggplot(dd2, aes(x=infected, y=count, fill=treatment))
basicC + geom_bar(stat="identity", position="dodge")

basicCC <- ggplot(dd2, aes(x=infected, y=prcnt*100, fill=treatment))
basicCC + geom_bar(stat="identity", position="dodge")
```

Together, these plots show that drug users who were vaccinated had significantly lower infection rates, supporting the vaccine's effectiveness.

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=Druguser)
rowPerc(table1)
colPerc(table1)
```

The rowPerc() output shows that 91.7% of vaccinated drug users avoided infection, compared to only 8.3% who still got infected, while 33% of those in the placebo group contracted COVID-19.The colPerc() results reinforce this difference — only 3.6% of vaccinated participants got COVID-19, versus 8.3% of placebo.





### Inferential 





```{r}
chisq.test(table1)
chisqtestGC(table1)
drugfish <- fisher.test(table1)
drugfish
```

The Chi-Square Test resulted in a very small p-value (1e-10), which strongly suggests that the observed differences in infection rate are not due to chance. The Fisher’s Exact Test confirms this with a p-value near 0 and an odds ratio of 2.81, meaning drug users who received the vaccine were about 2.8 times more likely to avoid infection than those who didn’t.

```{r}
effectiveness_drug = drugfish$estimate / (drugfish$estimate + 1) * 100
print(effectiveness_drug)

low = (drugfish$conf.int[1] / (drugfish$conf.int[1] + 1)) * 100
hi = (drugfish$conf.int[2] / (drugfish$conf.int[2] + 1)) * 100
options(digits=2)
```





## Effectiveness Confidence Interval `r low`  to `r hi`




The calculated effectiveness is 73.8%, with a confidence interval from 68.9% to 78.4%. Because the entire interval is above 50%, we conclude that the vaccine is highly effective for people who report drug use.

# Overall Results and Conclusions

The COVID-921 vaccine showed clear effectiveness across all four subgroups studied. For males, the vaccine reduced infection rates by approximately 64%, while for females, the effectiveness was about 67%. Among gay participants, the vaccine was 81% effective, and for drug users, effectiveness was around 74%. In each case, statistical tests showed that the differences in infection rates between the vaccine and placebo groups were significant and unlikely due to chance. Based on these findings, the vaccine is recommended for all subgroups, as it consistently lowered the risk of COVID-19 infection.