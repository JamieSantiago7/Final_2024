---
title: "Covid91 vaccine study Final2024"
author: "Jamie Santiago"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
males = filter(FinalData, sex == "M")
females = filter(FinalData, sex == "F")
gay = filter(FinalData, LGBTQ == "gay")
Druguser = filter(FinalData, DrugUser == "yes")
```



# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

### Barplot

```{r}
dd2 <- males %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=males)
rowPerc(table1)
colPerc(table1)
```




### Inferential 




```{r}
chisq.test(table1)
chisqtestGC(table1)
malefish <- fisher.test(table1)
malefish
```


```{r}
effectiveness_male = malefish$estimate / (malefish$estimate + 1) * 100
print(effectiveness_male)

low = (malefish$conf.int[1] / (malefish$conf.int[1] + 1)) * 100
hi = (malefish$conf.int[2] / (malefish$conf.int[2] + 1)) * 100
options(digits=2)
```







## Effectiveness Confidence Interval `r low`  to `r hi`







## Females

### Barplot

```{r}
dd2 <- females %>% group_by(infected, treatment) %>% summarize(count=n()) %>% mutate(prcnt = count/sum(count))

basicC <- ggplot(dd2, aes(x=infected, y=count, fill=treatment))
basicC + geom_bar(stat="identity", position="dodge")

basicCC <- ggplot(dd2, aes(x=infected, y=prcnt*100, fill=treatment))
basicCC + geom_bar(stat="identity", position="dodge")
```

### Numerical results


```{r}
table1 <- xtabs(~infected + treatment, data=females)
rowPerc(table1)
colPerc(table1)
```

### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
femfish <- fisher.test(table1)
femfish
```


```{r}
effectiveness_fem = femfish$estimate / (femfish$estimate + 1) * 100
print(effectiveness_fem)

low = (femfish$conf.int[1] / (femfish$conf.int[1] + 1)) * 100
hi = (femfish$conf.int[2] / (femfish$conf.int[2] + 1)) * 100
options(digits=2)
```







## Effectiveness Confidence Interval `r low`  to `r hi`







## LGBTQ

### Barplot

```{r}
dd2 <- gay %>% group_by(infected, treatment) %>% summarize(count=n()) %>% mutate(prcnt = count/sum(count))

basicC <- ggplot(dd2, aes(x=infected, y=count, fill=treatment))
basicC + geom_bar(stat="identity", position="dodge")

basicCC <- ggplot(dd2, aes(x=infected, y=prcnt*100, fill=treatment))
basicCC + geom_bar(stat="identity", position="dodge")
```

### Numerical results


```{r}
table1 <- xtabs(~infected + treatment, data=gay)
rowPerc(table1)
colPerc(table1)
```

### Inferential 




```{r}
chisq.test(table1)
chisqtestGC(table1)
gayfish <- fisher.test(table1)
gayfish
```

```{r}
effectiveness_gay = gayfish$estimate / (gayfish$estimate + 1) * 100
print(effectiveness_gay)

low = (gayfish$conf.int[1] / (gayfish$conf.int[1] + 1)) * 100
hi = (gayfish$conf.int[2] / (gayfish$conf.int[2] + 1)) * 100
options(digits=2)
```







## Effectiveness Confidence Interval `r low`  to `r hi`







## Druggies

### Barplot

```{r}
dd2 <- Druguser %>% group_by(infected, treatment) %>% summarize(count=n()) %>% mutate(prcnt = count/sum(count))

basicC <- ggplot(dd2, aes(x=infected, y=count, fill=treatment))
basicC + geom_bar(stat="identity", position="dodge")

basicCC <- ggplot(dd2, aes(x=infected, y=prcnt*100, fill=treatment))
basicCC + geom_bar(stat="identity", position="dodge")
```

Together, these plots show that drug users who were vaccinated had significantly lower infection rates, supporting the vaccine's effectiveness.

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=Druguser)
rowPerc(table1)
colPerc(table1)
```

The rowPerc() output shows that 91.7% of vaccinated drug users avoided infection, compared to only 8.3% who still got infected, while 33% of those in the placebo group contracted COVID-19.The colPerc() results reinforce this difference — only 3.6% of vaccinated participants got COVID-19, versus 8.3% of placebo.





### Inferential 





```{r}
chisq.test(table1)
chisqtestGC(table1)
drugfish <- fisher.test(table1)
drugfish
```

The Chi-Square Test resulted in a very small p-value (1e-10), which strongly suggests that the observed differences in infection rate are not due to chance. The Fisher’s Exact Test confirms this with a p-value near 0 and an odds ratio of 2.81, meaning drug users who received the vaccine were about 2.8 times more likely to avoid infection than those who didn’t.

```{r}
effectiveness_drug = drugfish$estimate / (drugfish$estimate + 1) * 100
print(effectiveness_drug)

low = (drugfish$conf.int[1] / (drugfish$conf.int[1] + 1)) * 100
hi = (drugfish$conf.int[2] / (drugfish$conf.int[2] + 1)) * 100
options(digits=2)
```





## Effectiveness Confidence Interval `r low`  to `r hi`




The calculated effectiveness is 73.8%, with a confidence interval from 68.9% to 78.4%. Because the entire interval is above 50%, we conclude that the vaccine is highly effective for people who report drug use.

# Overall Results and Conclusions